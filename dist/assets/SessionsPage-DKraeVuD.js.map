{"version":3,"file":"SessionsPage-DKraeVuD.js","sources":["../../src/features/sessions/components/SessionsTable.tsx","../../src/api/sessions.api.ts","../../src/features/sessions/hooks/useSessions.ts","../../src/pages/SessionsPage.tsx"],"sourcesContent":["import { memo } from \"react\";\nimport type { SessionItem } from \"../../../api/sessions.api\";\nimport { formatDateTime, truncate } from \"../../../utils/format\";\n\ntype SessionsTableProps = {\n  sessions: SessionItem[];\n  onRevoke: (sessionId: string) => void;\n  pendingSessionId?: string | null;\n};\n\nconst SessionsTableComponent = ({\n  sessions,\n  onRevoke,\n  pendingSessionId\n}: SessionsTableProps) => (\n  <div className=\"overflow-hidden rounded-xl border border-slate-200 bg-white shadow-soft\">\n    <div className=\"overflow-x-auto\">\n      <table className=\"min-w-full divide-y divide-slate-200\">\n        <thead className=\"bg-slate-50\">\n          <tr>\n            <th className=\"px-4 py-3 text-left text-xs font-semibold uppercase text-slate-500\">\n              Device\n            </th>\n            <th className=\"px-4 py-3 text-left text-xs font-semibold uppercase text-slate-500\">\n              IP\n            </th>\n            <th className=\"px-4 py-3 text-left text-xs font-semibold uppercase text-slate-500\">\n              Created\n            </th>\n            <th className=\"px-4 py-3 text-left text-xs font-semibold uppercase text-slate-500\">\n              Expires\n            </th>\n            <th className=\"px-4 py-3 text-right text-xs font-semibold uppercase text-slate-500\">\n              Action\n            </th>\n          </tr>\n        </thead>\n        <tbody className=\"divide-y divide-slate-100\">\n          {sessions.map((session) => {\n            const isLikelyCurrent = !!session.user_agent?.includes(navigator.userAgent);\n            return (\n              <tr key={session.id} className=\"hover:bg-slate-50\">\n                <td className=\"px-4 py-3 text-sm text-slate-700\">\n                  <div className=\"max-w-[320px]\">\n                    <p title={session.user_agent || \"\"}>\n                      {truncate(session.user_agent || \"Unknown device\", 65)}\n                    </p>\n                    {isLikelyCurrent ? (\n                      <span className=\"mt-1 inline-block rounded bg-emerald-100 px-2 py-0.5 text-xs font-medium text-emerald-700\">\n                        Likely current session\n                      </span>\n                    ) : null}\n                  </div>\n                </td>\n                <td className=\"px-4 py-3 text-sm text-slate-600\">\n                  {session.ip_address || \"Unknown\"}\n                </td>\n                <td className=\"px-4 py-3 text-sm text-slate-600\">\n                  {formatDateTime(session.created_at)}\n                </td>\n                <td className=\"px-4 py-3 text-sm text-slate-600\">\n                  {formatDateTime(session.expires_at)}\n                </td>\n                <td className=\"px-4 py-3 text-right\">\n                  <button\n                    className=\"rounded-md border border-rose-300 px-3 py-1.5 text-xs font-medium text-rose-600 hover:bg-rose-50 disabled:opacity-70\"\n                    onClick={() => onRevoke(session.id)}\n                    disabled={pendingSessionId === session.id}\n                  >\n                    {pendingSessionId === session.id ? \"Revoking...\" : \"Revoke\"}\n                  </button>\n                </td>\n              </tr>\n            );\n          })}\n        </tbody>\n      </table>\n    </div>\n  </div>\n);\n\nexport const SessionsTable = memo(SessionsTableComponent);\n","import { apiClient } from \"./axios\";\n\nexport type SessionItem = {\n  id: string;\n  ip_address: string | null;\n  user_agent: string | null;\n  created_at: string;\n  expires_at: string;\n};\n\nexport const sessionsApi = {\n  list: async () => {\n    const { data } = await apiClient.get<{ sessions: SessionItem[] }>(\"/auth/sessions\");\n    return data.sessions;\n  },\n  revoke: async (sessionId: string) => {\n    const { data } = await apiClient.delete<{ message: string }>(\n      `/auth/sessions/${sessionId}`\n    );\n    return data;\n  }\n};\n","import { useMutation, useQuery, useQueryClient } from \"@tanstack/react-query\";\nimport { authApi } from \"../../../api/auth.api\";\nimport { sessionsApi } from \"../../../api/sessions.api\";\n\nexport const useSessions = () =>\n  useQuery({\n    queryKey: [\"sessions\"],\n    queryFn: sessionsApi.list,\n    staleTime: 20_000\n  });\n\nexport const useRevokeSession = () => {\n  const queryClient = useQueryClient();\n\n  return useMutation({\n    mutationFn: (sessionId: string) => sessionsApi.revoke(sessionId),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"sessions\"] });\n    }\n  });\n};\n\nexport const useLogoutAllDevices = () => {\n  const queryClient = useQueryClient();\n\n  return useMutation({\n    mutationFn: authApi.logoutAll,\n    onSuccess: () => {\n      queryClient.clear();\n    }\n  });\n};\n","import { useState } from \"react\";\nimport { useNavigate } from \"react-router-dom\";\nimport { clearAuthenticated } from \"../app/authSlice\";\nimport { useAppDispatch } from \"../app/hooks\";\nimport { normalizeApiError } from \"../api/errors\";\nimport { useToast } from \"../components/ui/ToastProvider\";\nimport { ConfirmDialog } from \"../components/ui/ConfirmDialog\";\nimport { EmptyState } from \"../components/ui/EmptyState\";\nimport { TableSkeleton } from \"../components/ui/LoadingSkeleton\";\nimport { QueryErrorState } from \"../components/ui/QueryErrorState\";\nimport { SessionsTable } from \"../features/sessions/components/SessionsTable\";\nimport {\n  useLogoutAllDevices,\n  useRevokeSession,\n  useSessions\n} from \"../features/sessions/hooks/useSessions\";\n\nexport default function SessionsPage() {\n  const navigate = useNavigate();\n  const dispatch = useAppDispatch();\n  const { pushToast } = useToast();\n  const sessionsQuery = useSessions();\n  const revokeMutation = useRevokeSession();\n  const logoutAllMutation = useLogoutAllDevices();\n  const [revokeTarget, setRevokeTarget] = useState<string | null>(null);\n  const [showLogoutAllConfirm, setShowLogoutAllConfirm] = useState(false);\n\n  const onRevokeConfirm = async () => {\n    if (!revokeTarget) return;\n    try {\n      await revokeMutation.mutateAsync(revokeTarget);\n      pushToast(\"Session revoked\", \"success\");\n      setRevokeTarget(null);\n    } catch (err) {\n      pushToast(normalizeApiError(err).message, \"error\");\n    }\n  };\n\n  const onLogoutAllConfirm = async () => {\n    try {\n      await logoutAllMutation.mutateAsync();\n      dispatch(clearAuthenticated());\n      pushToast(\"Logged out from all devices\", \"success\");\n      navigate(\"/login\", { replace: true });\n    } catch (err) {\n      pushToast(normalizeApiError(err).message, \"error\");\n    }\n  };\n\n  return (\n    <div className=\"space-y-4\">\n      <section className=\"rounded-xl border border-slate-200 bg-white p-4 shadow-soft\">\n        <div className=\"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between\">\n          <div>\n            <h2 className=\"text-base font-semibold text-slate-900\">Session management</h2>\n            <p className=\"text-sm text-slate-600\">\n              Review device sessions by IP and revoke suspicious access.\n            </p>\n          </div>\n          <button\n            className=\"rounded-lg border border-rose-300 px-4 py-2 text-sm font-medium text-rose-600 hover:bg-rose-50\"\n            onClick={() => setShowLogoutAllConfirm(true)}\n          >\n            Logout all devices\n          </button>\n        </div>\n      </section>\n\n      {sessionsQuery.isPending ? <TableSkeleton rows={5} /> : null}\n\n      {sessionsQuery.isError ? (\n        <QueryErrorState\n          message={normalizeApiError(sessionsQuery.error).message}\n          onRetry={() => sessionsQuery.refetch()}\n        />\n      ) : null}\n\n      {!sessionsQuery.isPending && !sessionsQuery.isError ? (\n        (sessionsQuery.data?.length || 0) === 0 ? (\n          <EmptyState\n            title=\"No active sessions\"\n            description=\"Your account currently has no active refresh-token sessions.\"\n          />\n        ) : (\n          <SessionsTable\n            sessions={sessionsQuery.data || []}\n            onRevoke={(sessionId) => setRevokeTarget(sessionId)}\n            pendingSessionId={\n              revokeMutation.isPending ? (revokeMutation.variables ?? null) : null\n            }\n          />\n        )\n      ) : null}\n\n      <ConfirmDialog\n        isOpen={!!revokeTarget}\n        title=\"Revoke session\"\n        description=\"This session will be logged out immediately and cannot refresh tokens.\"\n        confirmLabel=\"Revoke\"\n        danger\n        isLoading={revokeMutation.isPending}\n        onCancel={() => setRevokeTarget(null)}\n        onConfirm={onRevokeConfirm}\n      />\n\n      <ConfirmDialog\n        isOpen={showLogoutAllConfirm}\n        title=\"Logout all devices\"\n        description=\"This will invalidate every session and require sign in again on all devices.\"\n        confirmLabel=\"Logout all\"\n        danger\n        isLoading={logoutAllMutation.isPending}\n        onCancel={() => setShowLogoutAllConfirm(false)}\n        onConfirm={onLogoutAllConfirm}\n      />\n    </div>\n  );\n}\n"],"names":["SessionsTableComponent","sessions","onRevoke","pendingSessionId","jsx","jsxs","session","isLikelyCurrent","_a","formatDateTime","SessionsTable","memo","sessionsApi","data","apiClient","sessionId","useSessions","useQuery","useRevokeSession","queryClient","useQueryClient","useMutation","useLogoutAllDevices","authApi","SessionsPage","navigate","useNavigate","dispatch","useAppDispatch","pushToast","useToast","sessionsQuery","revokeMutation","logoutAllMutation","revokeTarget","setRevokeTarget","useState","showLogoutAllConfirm","setShowLogoutAllConfirm","onRevokeConfirm","err","normalizeApiError","onLogoutAllConfirm","clearAuthenticated","TableSkeleton","QueryErrorState","EmptyState","ConfirmDialog"],"mappings":"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"}