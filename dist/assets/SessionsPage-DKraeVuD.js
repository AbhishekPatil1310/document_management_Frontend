import{j as e,u as k,c as v,b as y}from"./query-BkJnI4n_.js";import{a as u,u as w}from"./router-Bpws6W79.js";import{c as p,b as C,u as A,a as S,n as d,e as L}from"./index-Dbt0Mu8K.js";import{t as T,a as h,T as R,Q as E,E as P,C as g}from"./format-BAxQCyRA.js";import"./redux-LWk2volp.js";const q=({sessions:t,onRevoke:a,pendingSessionId:n})=>e.jsx("div",{className:"overflow-hidden rounded-xl border border-slate-200 bg-white shadow-soft",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-slate-200",children:[e.jsx("thead",{className:"bg-slate-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold uppercase text-slate-500",children:"Device"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold uppercase text-slate-500",children:"IP"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold uppercase text-slate-500",children:"Created"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold uppercase text-slate-500",children:"Expires"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-semibold uppercase text-slate-500",children:"Action"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-100",children:t.map(s=>{var r;const o=!!((r=s.user_agent)!=null&&r.includes(navigator.userAgent));return e.jsxs("tr",{className:"hover:bg-slate-50",children:[e.jsx("td",{className:"px-4 py-3 text-sm text-slate-700",children:e.jsxs("div",{className:"max-w-[320px]",children:[e.jsx("p",{title:s.user_agent||"",children:T(s.user_agent||"Unknown device",65)}),o?e.jsx("span",{className:"mt-1 inline-block rounded bg-emerald-100 px-2 py-0.5 text-xs font-medium text-emerald-700",children:"Likely current session"}):null]})}),e.jsx("td",{className:"px-4 py-3 text-sm text-slate-600",children:s.ip_address||"Unknown"}),e.jsx("td",{className:"px-4 py-3 text-sm text-slate-600",children:h(s.created_at)}),e.jsx("td",{className:"px-4 py-3 text-sm text-slate-600",children:h(s.expires_at)}),e.jsx("td",{className:"px-4 py-3 text-right",children:e.jsx("button",{className:"rounded-md border border-rose-300 px-3 py-1.5 text-xs font-medium text-rose-600 hover:bg-rose-50 disabled:opacity-70",onClick:()=>a(s.id),disabled:n===s.id,children:n===s.id?"Revoking...":"Revoke"})})]},s.id)})})]})})}),Q=u.memo(q),f={list:async()=>{const{data:t}=await p.get("/auth/sessions");return t.sessions},revoke:async t=>{const{data:a}=await p.delete(`/auth/sessions/${t}`);return a}},_=()=>k({queryKey:["sessions"],queryFn:f.list,staleTime:2e4}),D=()=>{const t=v();return y({mutationFn:a=>f.revoke(a),onSuccess:()=>{t.invalidateQueries({queryKey:["sessions"]})}})},F=()=>{const t=v();return y({mutationFn:C.logoutAll,onSuccess:()=>{t.clear()}})};function z(){var m;const t=w(),a=A(),{pushToast:n}=S(),s=_(),o=D(),r=F(),[l,c]=u.useState(null),[b,x]=u.useState(!1),j=async()=>{if(l)try{await o.mutateAsync(l),n("Session revoked","success"),c(null)}catch(i){n(d(i).message,"error")}},N=async()=>{try{await r.mutateAsync(),a(L()),n("Logged out from all devices","success"),t("/login",{replace:!0})}catch(i){n(d(i).message,"error")}};return e.jsxs("div",{className:"space-y-4",children:[e.jsx("section",{className:"rounded-xl border border-slate-200 bg-white p-4 shadow-soft",children:e.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-base font-semibold text-slate-900",children:"Session management"}),e.jsx("p",{className:"text-sm text-slate-600",children:"Review device sessions by IP and revoke suspicious access."})]}),e.jsx("button",{className:"rounded-lg border border-rose-300 px-4 py-2 text-sm font-medium text-rose-600 hover:bg-rose-50",onClick:()=>x(!0),children:"Logout all devices"})]})}),s.isPending?e.jsx(R,{rows:5}):null,s.isError?e.jsx(E,{message:d(s.error).message,onRetry:()=>s.refetch()}):null,!s.isPending&&!s.isError?(((m=s.data)==null?void 0:m.length)||0)===0?e.jsx(P,{title:"No active sessions",description:"Your account currently has no active refresh-token sessions."}):e.jsx(Q,{sessions:s.data||[],onRevoke:i=>c(i),pendingSessionId:o.isPending?o.variables??null:null}):null,e.jsx(g,{isOpen:!!l,title:"Revoke session",description:"This session will be logged out immediately and cannot refresh tokens.",confirmLabel:"Revoke",danger:!0,isLoading:o.isPending,onCancel:()=>c(null),onConfirm:j}),e.jsx(g,{isOpen:b,title:"Logout all devices",description:"This will invalidate every session and require sign in again on all devices.",confirmLabel:"Logout all",danger:!0,isLoading:r.isPending,onCancel:()=>x(!1),onConfirm:N})]})}export{z as default};
//# sourceMappingURL=SessionsPage-DKraeVuD.js.map
